---
title: "Robustness checks"
author: "Arturo Bertero"
date: "2024-04-15"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, error = FALSE, message = FALSE, warning = FALSE)
```

```{r}
library("pacman")
p_load(tidyverse, here, haven, countrycode, vdemdata, psych, lavaan, ltm,
       janitor, conflicted, sjPlot, BMA, BMS, fastDummies, ggplot2, reshape2,
       hrbrthemes, viridis, ggrepel)

#conflicts
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
```

```{r}
# import final data
data = read_rds(here("Input", "final_data", "final.rds"))

#as factor
data$country = as.factor(data$country)
data$year = as.factor(data$year)
data$country_year = as.factor(data$country_year)
```



# Introduction
In this report I show the final output we can use for the paper. All variables are rescaled from 0 to 1. I removed outliers for aspl measures, using the 3 SD criterion. The final sample is thus composed of 138 rather than 143 country_year units.

```{r}
# np_w as absoulte value
data$EES_COR_np_w = abs(data$EES_COR_np_w)
data$EES_GGM_glasso_np_w = abs(data$EES_GGM_glasso_np_w)
data$EES_GGM_huge_np_w = abs(data$EES_GGM_huge_np_w)
```

```{r}
# rescale function
rescale01 <- function(x) {(x - min(x)) / (max(x) - min(x))}

# Manually applying the function
data$EES_GGM_glasso_aspl = rescale01(data$EES_GGM_glasso_aspl) 
data$EES_GGM_glasso_np_i = rescale01(data$EES_GGM_glasso_np_i) 
data$EES_GGM_glasso_np_w = rescale01(data$EES_GGM_glasso_np_w)
data$EES_GGM_huge_aspl = rescale01(data$EES_GGM_huge_aspl) 
data$EES_GGM_huge_np_i = rescale01(data$EES_GGM_huge_np_i) 
data$EES_GGM_huge_np_w = rescale01(data$EES_GGM_huge_np_w)
data$EES_COR_aspl = rescale01(data$EES_COR_aspl) 
data$EES_COR_np_i = rescale01(data$EES_COR_np_i) 
data$EES_COR_np_w = rescale01(data$EES_COR_np_w)
data$educ = rescale01(data$educ)
data$ideol = rescale01(data$ideol)
data$mass_mob = rescale01(data$mass_mob)
data$p_inst_k = rescale01(data$p_inst_k)
data$pint = rescale01(data$pint)
data$pola = rescale01(data$pola)
data$turnout = rescale01(data$turnout)
data$ENEP = rescale01(data$ENEP)
data$gallagher = rescale01(data$gallagher)
```

```{r}
#robustness: remove outliers from aspl

# filter outliers
num_sd <- 3

# cor
# Calculate mean and sd
mean_aspl <- mean(data$EES_COR_aspl, na.rm = TRUE)
sd_aspl <- sd(data$EES_COR_aspl, na.rm = TRUE)

# Filter out outliers
data <- data %>%
  filter(EES_COR_aspl > (mean_aspl - num_sd * sd_aspl) & EES_COR_aspl < (mean_aspl + num_sd * sd_aspl))

# glasso
# Calculate mean and sd
mean_aspl <- mean(data$EES_GGM_glasso_aspl, na.rm = TRUE)
sd_aspl <- sd(data$EES_GGM_glasso_aspl, na.rm = TRUE)

# Filter out outliers
data <- data %>%
  filter(EES_GGM_glasso_aspl > (mean_aspl - num_sd * sd_aspl) & EES_GGM_glasso_aspl < (mean_aspl + num_sd * sd_aspl))

# huge
# Calculate mean and sd
mean_aspl <- mean(data$EES_GGM_huge_aspl, na.rm = TRUE)
sd_aspl <- sd(data$EES_GGM_huge_aspl, na.rm = TRUE)

# Filter out outliers
data <- data %>%
  filter(EES_GGM_huge_aspl > (mean_aspl - num_sd * sd_aspl) & EES_GGM_huge_aspl < (mean_aspl + num_sd * sd_aspl))

```

```{r}
# data preparation for bms 

bms <- data %>%
  # Creating dummy variables for 'country' and 'year'
  dummy_cols(select_columns = c("country", "year"), remove_selected_columns = T) %>% 
  # exclude one dummy for country and one for year
  select(-c(country_AUT, year_1989))

# create data frame with DV as first col
#cor_cons
bms_cor_cons = bms %>% 
  select(EES_COR_constraint, alt_inf:gallagher, country_BEL:year_2019)

#cor_aspl
bms_cor_aspl = bms %>% 
  select(EES_COR_aspl, alt_inf:p_inst, pint, pola, ihdi:gallagher, country_BEL:year_2019)

# glasso_cor
bms_glasso_cons = bms %>% 
  select(EES_GGM_glasso_constraint, alt_inf:p_inst, pint, pola, ihdi:gallagher, country_BEL:year_2019)

# glasso_aspl
bms_glasso_aspl = bms %>% 
  select(EES_GGM_glasso_aspl, alt_inf:p_inst, pint, pola, ihdi:gallagher, country_BEL:year_2019)

# huge_cor
bms_huge_cons = bms %>% 
  select(EES_GGM_huge_constraint, alt_inf:p_inst, pint, pola, ihdi:gallagher, country_BEL:year_2019)

# huge_aspl
bms_huge_aspl = bms %>% 
  select(EES_GGM_huge_aspl, alt_inf:p_inst, pint, pola, ihdi:gallagher, country_BEL:year_2019)
```

# Descriptives
Same plots, with the trimmed distributions
```{r}
# data preparation
violin_data = data %>% 
  select("EES_COR_constraint", "EES_GGM_huge_constraint", "EES_GGM_glasso_constraint") 

long_violin_data = melt(violin_data, variable.name = "Model", value.name = "Value")

# violin plot

# Calculate the sample sizes
sample_size <- long_violin_data %>% group_by(Model) %>% summarize(num=n())

# Join the sample and violin data 
plot_data <- long_violin_data %>%
  left_join(sample_size, by = "Model") %>%
  mutate(myaxis = paste0(Model, "\n", "n=", num))

# Create the plot
violin_plot <- ggplot(plot_data, aes(x=myaxis, y=Value, fill=Model)) +
  geom_violin(position=position_dodge(width=0.25), width=0.8) +
  geom_boxplot(width=0.1, color="grey", alpha=0.2, position=position_dodge(width=0.25)) +
  scale_fill_viridis(discrete = TRUE) +
  theme_ipsum(base_size = 14) +
  theme(
    legend.position = "none",
    plot.title = element_text(size=14)
  ) +
  labs(title="Aggregated distribution of Constraint", x="", y="Constraint") +
  scale_x_discrete(labels=c("Correlation", "Glasso", "Huge"))

# Print 
print(violin_plot)
```


```{r}
# data preparation
violin_data_aspl = data %>% 
  select("EES_COR_aspl", "EES_GGM_huge_aspl", "EES_GGM_glasso_aspl") 

long_violin_data_aspl = melt(violin_data_aspl, variable.name = "Model", value.name = "Value")

# violin plot

# Calculate the sample sizes
sample_size <- long_violin_data_aspl %>% group_by(Model) %>% summarize(num=n())

# Join the sample and violin data 
plot_data_aspl <- long_violin_data_aspl %>%
  left_join(sample_size, by = "Model") %>%
  mutate(myaxis = paste0(Model, "\n", "n=", num))

# Create the plot
violin_plot_aspl <- ggplot(plot_data_aspl, aes(x=myaxis, y=Value, fill=Model)) +
  geom_violin(position=position_dodge(width=0.25), width=0.8) +
  geom_boxplot(width=0.1, color="grey", alpha=0.2, position=position_dodge(width=0.25)) +
  scale_fill_viridis(discrete = TRUE) +
  theme_ipsum(base_size = 14) +
  theme(
    legend.position = "none",
    plot.title = element_text(size=14)
  ) +
  labs(title="Aggregated distribution of ASPL", x="", y="ASPL") +
  scale_x_discrete(labels=c("Correlation", "Glasso", "Huge"))

# Print 
print(violin_plot_aspl)
```


```{r fig.width=16, fig.height=8}
# data
cons_trend <- data %>%
  select(year, country, EES_COR_constraint, EES_GGM_huge_constraint, EES_GGM_glasso_constraint) 

long_cons_trend = melt(cons_trend, variable.name = "Model", value.name = "Value")


#graph
cons_trend_graph = long_cons_trend %>%
  ggplot(aes(x = year, y = Value, group = interaction(country, Model), color = Model)) +
    geom_line() +
    geom_point() +
    facet_wrap(~country) +  
    scale_color_viridis_d(labels = c("Correlation", "Glasso", "Huge")) +  # Custom legend labels
    theme_minimal() +
    theme(legend.position = "bottom") +
    labs(title = "Temporal Development of Constraint",
         x = "Year", 
         y = "Constraint",
         color = "Model Type") 

# Print the graph
print(cons_trend_graph)
```


```{r fig.width=16, fig.height=8}
# data
aspl_trend <- data %>%
  select(year, country, EES_COR_aspl, EES_GGM_huge_aspl, EES_GGM_glasso_aspl) 

long_aspl_trend = melt(aspl_trend, variable.name = "Model", value.name = "Value")


#graph
aspl_trend_graph = long_aspl_trend %>%
  ggplot(aes(x = year, y = Value, group = interaction(country, Model), color = Model)) +
    geom_line() +
    geom_point() +
    facet_wrap(~country) +  
    scale_color_viridis_d(labels = c("Correlation", "Glasso", "Huge")) +  # Custom legend labels
    theme_minimal() +
    theme(legend.position = "bottom") +
    labs(title = "Temporal Development of ASPL",
         x = "Year", 
         y = "Constraint",
         color = "Model Type") 

# Print the graph
print(aspl_trend_graph)
```

# Part 1: What does predict network connectivity? 
In this part of the report I only estimate OLS models on huge ASPL. BMA models, and OLS regressions predicting values of the cor and huge_pcor network measures (both constraint and ASPL) will be shown in the appendix (robustness checks). As predictors, I use the three most reliable factors we have found in the literature: political interest (pint) party institutionalization (p_inst), and party polarization (pola). Please note I did not take the inverse of ASPL, therefore, negative coefficient = positive association. 

- First set of models: 
  - M1: huge_aspl = p_inst + country + year
  - M2: huge_aspl = p_inst + pola + country + year
  - M3: huge_aspl = p_inst + pola + pint + country + year
```{r}
huge_aspl <-   lm(EES_GGM_huge_aspl ~ p_inst + country + year , data = data)
huge_aspl_2 <- lm(EES_GGM_huge_aspl ~ p_inst + pola + country + year , data = data)
huge_aspl_3 <- lm(EES_GGM_huge_aspl ~ p_inst + pola + pint + country + year , data = data)

tab_model(list(huge_aspl, huge_aspl_2, huge_aspl_3),
          show.p = TRUE,
          p.style = "stars",
          p.threshold = c(0.1, 0.05, 0.01),
          dv.labels = c("M1", "M2", "M3"),
          collapse.ci = TRUE,
          show.aic = TRUE,
          title = "OLS fixed effects (country and years) on ASPL of huge network",
          string.pred = " ",
          auto.label = FALSE,
          terms = c("p_inst", "pola", "pint"))
```

- Second set of models (controls): 
  - M1: huge_aspl = p_inst + country + year + ENEP + gallagher + ihdi
  - M2: huge_aspl = p_inst + pola + country + year + ENEP + gallagher + ihdi
  - M3: huge_aspl = p_inst + pola + pint + country + year + ENEP + gallagher + ihdi
  
I don't show coefficients for control Vs (ENEP, gallagher, ihdi). They are not significant.
```{r}
huge_aspl_c <-   lm(EES_GGM_huge_aspl ~ p_inst + country + year + ENEP + gallagher + ihdi , data = data)
huge_aspl_2_c <- lm(EES_GGM_huge_aspl ~ p_inst + pola + country + year + ENEP + gallagher + ihdi, data = data)
huge_aspl_3_c <- lm(EES_GGM_huge_aspl ~ p_inst + pola + pint + country + year + ENEP + gallagher + ihdi, data = data)


tab_model(list(huge_aspl_c, huge_aspl_2_c, huge_aspl_3_c),
          show.p = TRUE,
          p.style = "stars",
          p.threshold = c(0.1, 0.05, 0.01),
          dv.labels = c("M1", "M2", "M3"),
          collapse.ci = TRUE,
          show.aic = TRUE,
          title = "OLS fixed effects (country and years), controls, on huge_aspl",
          string.pred = " ",
          auto.label = FALSE,
          terms = c("pola", "p_inst", "pint"))
```

## Summary and graph
We have two solid predictors: p_inst and pola. Pint is not significant and, additionally, points in the "wrong" direction. Now the scatterplot between huge_aspl and p_inst. Unfortunately, it looks miserable. Correlation between the two measures is -0.01206442. 

```{r}
# Mutate the country_year column
data_scatt <- data %>%
  mutate(
    iso2c = countrycode(substr(country_year, 1, 3), "iso3c", "iso2c"),
    year = substr(country_year, 6, 7),
    country_year_modified = paste(iso2c, year, sep = "_")
  )

#plot
scatt1 = ggplot(data_scatt, aes(x = p_inst, y = EES_GGM_huge_aspl)) +
  geom_point(size = 1) +  
  geom_smooth(method = lm, color = "pink", fill = "#69b3a2", se = TRUE) +
  theme_ipsum() +
  labs(title = "Scatterplot of huge_aspl and p_inst",
       x = "p_inst",
       y = "EES_GGM_huge_aspl") +
  geom_text_repel(aes(label = country_year_modified), size = 2)

print(scatt1)
```

# Part 2: What are the consequences of network characteristics? 

Also here I rescale all predictors (and not the dvs); there are not outliers for turnout to be removed; I take the absolute of the np_w measure; I remove outliers for the np_i measure (from 143 to 136 observation); I remove outliers for the np_w measure (from 136 to 126 observation). I show models where ratio measures of huge networks predict EU turnout (turnout) and national turnout (turnout_nat). 

Here is the graph of the distributions of EU turnout and national turnout.
```{r}
# import final data
turnout = read_rds(here("Input", "final_data", "final_turnout.rds"))

#as factor
turnout$country = as.factor(turnout$country)
turnout$year = as.factor(turnout$year)
turnout$country_year = as.factor(turnout$country_year)
turnout$infla = as.numeric(turnout$infla)
turnout$mand = as.numeric(turnout$mand)
```

```{r}
# np_w as absoulte value
turnout$EES_COR_np_w = abs(turnout$EES_COR_np_w)
turnout$EES_GGM_glasso_np_w = abs(turnout$EES_GGM_glasso_np_w)
turnout$EES_GGM_huge_np_w = abs(turnout$EES_GGM_huge_np_w)
```

```{r}
# rescale function
rescale01 <- function(x) {(x - min(x)) / (max(x) - min(x))}

# Manually applying the function
turnout$EES_GGM_glasso_aspl = rescale01(turnout$EES_GGM_glasso_aspl) 
turnout$EES_GGM_glasso_np_i = rescale01(turnout$EES_GGM_glasso_np_i) 
turnout$EES_GGM_glasso_np_w = rescale01(turnout$EES_GGM_glasso_np_w)
turnout$EES_GGM_huge_aspl = rescale01(turnout$EES_GGM_huge_aspl) 
turnout$EES_GGM_huge_np_i = rescale01(turnout$EES_GGM_huge_np_i) 
turnout$EES_GGM_huge_np_w = rescale01(turnout$EES_GGM_huge_np_w)
turnout$EES_COR_aspl = rescale01(turnout$EES_COR_aspl) 
turnout$EES_COR_np_i = rescale01(turnout$EES_COR_np_i) 
turnout$EES_COR_np_w = rescale01(turnout$EES_COR_np_w)
turnout$educ = rescale01(turnout$educ)
turnout$ideol = rescale01(turnout$ideol)
turnout$mass_mob = rescale01(turnout$mass_mob)
turnout$p_inst_k = rescale01(turnout$p_inst_k)
turnout$pint = rescale01(turnout$pint)
turnout$pola = rescale01(turnout$pola)
turnout$ENEP = rescale01(turnout$ENEP)
turnout$gallagher = rescale01(turnout$gallagher)
```

```{r}
#robustness: remove outliers from turnout

# filter outliers
num_sd <- 3

# cor
# Calculate mean and sd
mean_turn <- mean(turnout$turnout, na.rm = TRUE)
sd_turn <- sd(turnout$turnout, na.rm = TRUE)

# Filter out outliers
turnout <- turnout %>%
  filter(turnout > (mean_turn - num_sd * sd_turn) & turnout < (mean_turn + num_sd * sd_turn))

```

```{r}
#robustness: remove outliers from np_i

# filter outliers
num_sd <- 3

# cor
# Calculate mean and sd
mean_np <- mean(turnout$EES_COR_np_i, na.rm = TRUE)
sd_np <- sd(turnout$EES_COR_np_i, na.rm = TRUE)

# Filter out outliers
turnout <- turnout %>%
  filter(EES_COR_np_i > (mean_np - num_sd * sd_np) & EES_COR_np_i < (mean_np + num_sd * sd_np))

# glasso
# Calculate mean and sd
mean_np <- mean(turnout$EES_GGM_glasso_np_i, na.rm = TRUE)
sd_np <- sd(turnout$EES_GGM_glasso_np_i, na.rm = TRUE)

# Filter out outliers
turnout <- turnout %>%
  filter(EES_GGM_glasso_np_i > (mean_np - num_sd * sd_np) & EES_GGM_glasso_np_i < (mean_np + num_sd * sd_np))

# huge
# Calculate mean and sd
mean_np <- mean(turnout$EES_GGM_huge_np_i, na.rm = TRUE)
sd_np <- sd(turnout$EES_GGM_huge_np_i, na.rm = TRUE)

# Filter out outliers
turnout <- turnout %>%
  filter(EES_GGM_huge_np_i > (mean_np - num_sd * sd_np) & EES_GGM_huge_np_i < (mean_np + num_sd * sd_np))

```

```{r}
#robustness: remove outliers from np_w

# filter outliers
num_sd <- 3

# cor
# Calculate mean and sd
mean_np <- mean(turnout$EES_COR_np_w, na.rm = TRUE)
sd_np <- sd(turnout$EES_COR_np_w, na.rm = TRUE)

# Filter out outliers
turnout <- turnout %>%
  filter(EES_COR_np_w > (mean_np - num_sd * sd_np) & EES_COR_np_w < (mean_np + num_sd * sd_np))

# glasso
# Calculate mean and sd
mean_np <- mean(turnout$EES_GGM_glasso_np_w, na.rm = TRUE)
sd_np <- sd(turnout$EES_GGM_glasso_np_w, na.rm = TRUE)

# Filter out outliers
turnout <- turnout %>%
  filter(EES_GGM_glasso_np_w > (mean_np - num_sd * sd_np) & EES_GGM_glasso_np_w < (mean_np + num_sd * sd_np))

# huge
# Calculate mean and sd
mean_np <- mean(turnout$EES_GGM_huge_np_w, na.rm = TRUE)
sd_np <- sd(turnout$EES_GGM_huge_np_w, na.rm = TRUE)

# Filter out outliers
turnout <- turnout %>%
  filter(EES_GGM_huge_np_w > (mean_np - num_sd * sd_np) & EES_GGM_huge_np_w < (mean_np + num_sd * sd_np))
```


```{r}
# Data preparation
violin_data_aspl = turnout %>% 
  select(turnout, turnout_nat)

# Reshape the data to long format
long_violin_data_aspl = melt(violin_data_aspl, variable.name = "Model", value.name = "Value")

# Calculate the sample sizes
sample_size <- long_violin_data_aspl %>% group_by(Model) %>% summarize(num = n())

# Join the sample and violin data
plot_data_aspl <- long_violin_data_aspl %>%
  left_join(sample_size, by = "Model") %>%
  mutate(myaxis = paste0(Model, "\n", "n=", num))

# Create the plot
violin_plot_aspl <- ggplot(plot_data_aspl, aes(x = myaxis, y = Value, fill = Model)) +
  geom_violin(position = position_dodge(width = 0.25), width = 0.8) +
  geom_boxplot(width = 0.1, color = "grey", alpha = 0.2, position = position_dodge(width = 0.25)) +
  scale_fill_viridis(discrete = TRUE) +
  theme_ipsum(base_size = 14) +
  theme(
    legend.position = "none",
    plot.title = element_text(size = 14)
  ) +
  labs(title = "Aggregated distribution of Turnout", x = "", y = "Turnout") +
  scale_x_discrete(labels = c("turnout" = "Turnout", "turnout_nat" = "Turnout National"))

# Print the plot
print(violin_plot_aspl)
```

### Do the ratio measures predict greater turnout?

- First set of models
  - M1: EU turnout = EES_GGM_huge_np_i + country + year
  - M2: EU turnout = EES_GGM_huge_np_w + country + year
  - M3: National turnout = EES_GGM_huge_np_i + country + year
  - M4: National turnout = EES_GGM_huge_np_w + country + year

The weighted measures perform very well in predicting both types of turnout.  
  
```{r}
# reg turnout
tur_eu_i = lm(turnout ~ EES_GGM_huge_np_i + country + year, data = turnout)
tur_eu_w = lm(turnout ~ EES_GGM_huge_np_w + country + year, data = turnout)
tur_na_i = lm(turnout_nat ~ EES_GGM_huge_np_i + country + year, data = turnout)
tur_na_w = lm(turnout_nat ~ EES_GGM_huge_np_w + country + year, data = turnout)

tab_model(list(tur_eu_i, tur_eu_w, tur_na_i, tur_na_w),
          show.p = TRUE,
          p.style = "stars",
          p.threshold = c(0.1, 0.05, 0.01),
          dv.labels = c("M1", "M2", "M3", "M4"),
          collapse.ci = TRUE,
          show.aic = TRUE,
          title = "OLS fixed effects (country and years) ratio measures and turnout(s)",
          string.pred = " ",
          auto.label = FALSE,
          terms = c("EES_GGM_huge_np_i", "EES_GGM_huge_np_w"))

```

- Second set of models (controls)
  - M1: EU turnout = EES_GGM_huge_np_i + country + year + mand + gdp + infla + ihdi + pola + ENEP
  - M2: EU turnout = EES_GGM_huge_np_w + country + year + mand + gdp + infla + ihdi + pola + ENEP
  - M3: National turnout = EES_GGM_huge_np_i + country + year + mand + gdp + infla + ihdi + pola + ENEP
  - M4: National turnout = EES_GGM_huge_np_w + country + year + mand + gdp + infla + ihdi + pola + ENEP
  
Once again we have solid findings for the weighted measures, even if considering turnout  

```{r}
# reg turnout
tur_eu_i_c = lm(turnout ~ EES_GGM_huge_np_i + country + year + mand + gdp + infla + ihdi + pola + ENEP, data = turnout)
tur_eu_w_c = lm(turnout ~ EES_GGM_huge_np_w + country + year + mand + gdp + infla + ihdi + pola + ENEP, data = turnout)
tur_na_i_c = lm(turnout_nat ~ EES_GGM_huge_np_i + country + year + mand + gdp + infla + ihdi + pola + ENEP, data = turnout)
tur_na_w_c = lm(turnout_nat ~ EES_GGM_huge_np_w + country + year + mand + gdp + infla + ihdi + pola + ENEP, data = turnout)

tab_model(list(tur_eu_i_c, tur_eu_w_c, tur_na_i_c, tur_na_w_c),
          show.p = TRUE,
          p.style = "stars",
          p.threshold = c(0.1, 0.05, 0.01),
          dv.labels = c("M1", "M2", "M3", "M4"),
          collapse.ci = TRUE,
          show.aic = TRUE,
          title = "OLS fixed effects (country and years) ratio measures and turnout(s)",
          string.pred = " ",
          auto.label = FALSE,
          terms = c("EES_GGM_huge_np_i", "EES_GGM_huge_np_w", "mand", "gdp", "infla", "ihdi", "pola"))
```

## Summary
Results holds for the other measure of turnout (national elections). The weighted version of the ratio measure seems very solid. Here is the scatterplot for the EU elections. 

```{r}
# Mutate the country_year column
data_scatt_2 <- turnout %>%
  mutate(
    iso2c = countrycode(substr(country_year, 1, 3), "iso3c", "iso2c"),
    year = substr(country_year, 6, 7),
    country_year_modified = paste(iso2c, year, sep = "_")
  )

#plot
scatt2 = ggplot(data_scatt_2, aes(x = EES_GGM_huge_np_w, y = turnout)) +
  geom_point(size = 1) +  
  geom_smooth(method = lm, color = "pink", fill = "#69b3a2", se = TRUE) +
  theme_ipsum() +
  labs(title = "Scatterplot of huge_aspl weighted ratio and EU turnout",
       x = "huge_np_w",
       y = "EU turnout") +
  geom_text_repel(aes(label = country_year_modified), size = 2)

print(scatt2)
```

Here is the scatterplot for the national elections

```{r}
# Mutate the country_year column
data_scatt_3 <- turnout %>%
  mutate(
    iso2c = countrycode(substr(country_year, 1, 3), "iso3c", "iso2c"),
    year = substr(country_year, 6, 7),
    country_year_modified = paste(iso2c, year, sep = "_")
  )

#plot
scatt3 = ggplot(data_scatt_3, aes(x = EES_GGM_huge_np_w, y = turnout_nat)) +
  geom_point(size = 1) +  
  geom_smooth(method = lm, color = "pink", fill = "#69b3a2", se = TRUE) +
  theme_ipsum() +
  labs(title = "Scatterplot of huge_aspl weighted ratio and national turnout",
       x = "huge_np_w",
       y = "National turnout") +
  geom_text_repel(aes(label = country_year_modified), size = 2)

print(scatt3)
```

